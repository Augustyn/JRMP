##Velocity template for Jira Risk Managment Gadget
##It is used to generate html code of gadget view
##
##Template params:
##
##  projectLabel - String - project or filter translated label
##  projectURL - String - project or filter URL
##  projectName - String - project or filter name
##  riskDateLabel - String - label for date when matrix was generated
##  date - String - date when matrix was generated
##  updatedLabel - Stirng - label for last updated task
##  updateDate - Stirgn - date of modification of last updated task
##  updatedTaskUrl - String - url to last updated task
##  updatedTask - String - key for last updated task
##  redTasksLabel - Stirng - label for red tasks counter
##  redTasksValue - int - red tasks counter value
##  yelloeTasksLabel - Stirng - label for yellow tasks counter
##  yellowTasksValue - int - yellow tasks counter value
##  greenTasksLabel - Stirng - label for green tasks counter
##  greenTasksValue - int - green tasks counter value
##  matrixSize - int - matrix size
##  overloadCommentMulti - String - comment for overload cell plural form
##  overloadCommentMulti_2 - String - comment for overload cell plural form
##  overloadCommentSingle - String - comment for overload cell singular form
##  matrix - List<net.amg.jira.plugns.jrmp.velocity.Row> - list of rows for risk matrix
##  consequenceLabel - String - translated label for risk consequence
##  probabilityLabel - String - translated label for risk probability

<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Risk Matrix</title>
<link rel="stylesheet" type="text/css" href="matrixStyle.css">
<div class="amg jrmp matrix default">
    <div class="matrixHeaderRow">
        <div class="projectLabeL">$projectLabel</div> <a href="$projectURL">$projectName</a> &nbsp&nbsp <div class="riskDateLabel"> $riskDateLabel $date</div><br>
    </div>
    <div class="matrixHeaderRow">
        <div class="updatedLabel">$updatedLabel $updateDate (<a href="$updatedTaskUrl">$updatedTask</a>)</div> <div class="separator">|</div>
        <div class="redTasksLabel">$redTasksLabel</div> <div class="tasksValue">$redTasksValue</div> <div class="separator">|</div>
        <div class="yellowTasksLabel">$yellowTasksLabel</div> <div class="tasksValue">$yellowTasksValue</div> <div class="separator">|</div>
        <div class="greenTasksLabel">$greenTasksLabel</div> <div class="tasksValue">$greenTasksValue</div>
    </div>
<table class="matrix">
    #set ($counter = $matrixSize)
    #foreach($row in $matrix)
        <tr>
            #if ($counter == $matrixSize)
                <td rowspan="$matrixSize"><div class="ylabel">$probabilityLabel</div></td>
            #end
            <td class="y">$counter</td>
            #foreach($cell in $row.cells)
                <td class="$cell.risk">
                    #set ($cellCounter = 0)
                    #foreach($task in $cell.tasks)
                        <a href="$task.url">$task.name</a><br>
                        #set ($cellCounter = $cellCounter + 1)
                        #if($cellCounter == 2)
                            #if($cell.overload == 1)
                                +$cell.overload $overloadCommentSingle
                                #elseif ($cell.overload < 5)
                                    +$cell.overload $overloadCommentMulti
                            #else
                                +$cell.overload $overloadCommentMulti_2
                            #end
                            #break($foreach)
                        #end
                    #end
                </td>
            #end
        </tr>
        #set ($counter = $counter - 1)
    #end
    <tr>
        <td class="empty"></td>
        <td class="empty"></td>
        #foreach($i in [1..$matrixSize])
            <td class="x">$i</td>
        #end
    </tr>
    <tr>
        <td class="empty"></td>
        <td class="empty"></td>
        <td class="xlabel" colspan="$matrixSize">$consequenceLabel</td>
    </tr>
</table>
</div>
</html>
